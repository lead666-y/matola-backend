<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Upload Matola</title>
  <style>
    body {
      background: #111;
      color: #f5c518;
      font-family: sans-serif;
      padding: 20px;
    }
    h2 { margin-top: 30px; }
    input, button {
      padding: 8px;
      margin: 5px 0;
      border-radius: 10px;
      border: none;
      outline: none;
    }
    input[type="text"], input[type="file"] {
      width: 100%;
    }
    button {
      background: #f5c518;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }
    .bloco {
      background: #1a1a1a;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    #erro { color: red; }
  </style>
</head>
<body>

  <!-- BLOCO 1: FOTO DE PERFIL -->
  <div class="bloco">
    <h2>üì∑ Escolher Imagem de Perfil</h2>
    <input type="file" accept="image/*" onchange="salvarFotoPerfil(this)">
    <p>Essa ser√° sua foto de canal na plataforma.</p>
  </div>

  <!-- BLOCO 2: POSTAGEM DE V√çDEO -->
  <div class="bloco">
    <h2>üé• Postar um V√≠deo</h2>
    <input id="id_nome" type="text" placeholder="Seu ID + nome (obrigat√≥rio)">
    <input id="titulo" type="text" placeholder="T√≠tulo do v√≠deo">
    <input id="descricao" type="text" placeholder="Descri√ß√£o do v√≠deo">
    <input id="arquivo" type="file" accept="video/*">
    <button onclick="postarVideo()">üì§ Enviar v√≠deo</button>
    <p id="erro"></p>
  </div>

  <script>
    function salvarFotoPerfil(input) {
      const file = input.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function () {
        localStorage.setItem("foto_matola", reader.result);
        alert("‚úÖ Foto de perfil atualizada!");
      };
      reader.readAsDataURL(file);
    }

    function postarVideo() {
      const idNome = document.getElementById('id_nome').value.trim();
      const titulo = document.getElementById('titulo').value.trim();
      const descricao = document.getElementById('descricao').value.trim();
      const file = document.getElementById('arquivo').files[0];

      if (!idNome || !titulo || !descricao || !file) {
        document.getElementById('erro').textContent = "‚ö†Ô∏è Preencha todos os campos corretamente.";
        return;
      }

      // Verificar se id + nome existe no localStorage
      const idSaved = localStorage.getItem("id_matola");
      const nomeSaved = localStorage.getItem("nome_matola");
      const esperado = idSaved + " " + nomeSaved;

      if (idNome !== esperado) {
        document.getElementById('erro').textContent = "‚ùå ID + nome inv√°lidos. Verifique seu login.";
        return;
      }

      const reader = new FileReader();
      reader.onload = function () {
        let videos = JSON.parse(localStorage.getItem("videos_publicados")) || [];
        videos.push({
          id: idSaved,
          nome: nomeSaved,
          titulo,
          descricao,
          data: new Date().toLocaleString(),
          arquivoBase64: reader.result
        });
        localStorage.setItem("videos_publicados", JSON.stringify(videos));
        alert("‚úÖ V√≠deo postado com sucesso!");
        window.location.href = "index.html";
      };
      reader.readAsDataURL(file);
    }
  </script>

</body>
</html>
